<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AXCELIS íŒŒíŠ¸ê²€ìƒ‰</title>
    
    <!-- PWA ì„¤ì • -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AXCELIS íŒŒíŠ¸ê²€ìƒ‰">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="./manifest.json">
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ”%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ”%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.3/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top, 0px));
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .title {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 25px;
        }
        
        .github-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #24292e 0%, #4f46e5 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .upload-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .upload-section:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .status-info {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .status-sample {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-uploaded {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-restored {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .search-box {
            margin: 25px 0;
        }
        
        .search-input {
            width: 100%;
            padding: 18px 24px;
            font-size: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .search-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-google {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
        }
        
        .btn-google:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
        }
        
        .btn-image {
            background: linear-gradient(135deg, #ea4335 0%, #fbbc04 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(234, 67, 53, 0.3);
        }
        
        .btn-image:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(234, 67, 53, 0.4);
        }
        
        .stats {
            text-align: center;
            margin: 25px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            font-weight: 600;
            color: #374151;
        }
        
        .results {
            display: grid;
            gap: 20px;
        }
        
        .part-item {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #2563eb;
        }
        
        .part-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .part-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .part-name {
            font-size: 1.2rem;
            color: #374151;
            margin-bottom: 20px;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .part-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #e2e8f0;
        }
        
        .detail-label {
            color: #6b7280;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            color: #374151;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .detail-price {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border-left-color: #22c55e;
        }
        
        .detail-category {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #7c3aed;
            border-left-color: #8b5cf6;
        }
        
        .detail-location {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            color: #059669;
            border-left-color: #10b981;
        }
        
        .part-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 30px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .no-results h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .no-results p {
            color: #6b7280;
            margin-bottom: 25px;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2563eb;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.4);
            cursor: pointer;
            z-index: 1000;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .install-prompt:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 25px rgba(37, 99, 235, 0.5);
        }
        
        @media (max-width: 768px) {
            .container { 
                padding: 15px; 
                padding-top: max(15px, env(safe-area-inset-top, 0px));
            }
            .header { padding: 25px; }
            .title { font-size: 2.2rem; }
            .search-buttons { flex-direction: column; align-items: center; }
            .part-details { grid-template-columns: 1fr; }
            .part-actions { justify-content: center; }
            .install-prompt { 
                bottom: max(20px, env(safe-area-inset-bottom, 0px));
                left: 20px;
                right: 20px;
                transform: none;
                text-align: center;
            }
            .github-badge {
                position: static;
                display: inline-block;
                margin-bottom: 15px;
            }
        }
        
        @media (display-mode: standalone) {
            .github-badge::after {
                content: " (ì•±ëª¨ë“œ)";
                color: #22c55e;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const PartSearchApp = () => {
            const [searchTerm, setSearchTerm] = useState('');
            const [parts, setParts] = useState([]);
            const [loading, setLoading] = useState(false);
            const [dataSource, setDataSource] = useState('sample');
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            
            // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
            useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setShowInstallPrompt(true);
                };
                
                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                
                // ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ìˆ¨ê¸°ê¸°
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    setShowInstallPrompt(false);
                }
                
                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                };
            }, []);
            
            const handleInstallClick = async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    setShowInstallPrompt(false);
                }
                setDeferredPrompt(null);
            };
            
            // CSV íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                console.log('íŒŒì¼ ì„ íƒë¨:', file.name, 'í¬ê¸°:', (file.size/1024/1024).toFixed(2) + 'MB', 'íƒ€ì…:', file.type);
                
                if (!file.name.toLowerCase().endsWith('.csv')) {
                    alert('âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
                
                // ëŒ€ìš©ëŸ‰ íŒŒì¼ ê²½ê³  (ëª¨ë°”ì¼ ìµœì í™”)
                if (file.size > 5 * 1024 * 1024) { // 5MB ì´ˆê³¼
                    if (!confirm('ğŸ“± ëŒ€ìš©ëŸ‰ íŒŒì¼ì…ë‹ˆë‹¤. ëª¨ë°”ì¼ì—ì„œëŠ” ì²˜ë¦¬ê°€ ëŠë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        return;
                    }
                }
                
                setLoading(true);
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        console.log('íŒŒì¼ ì½ê¸° ì™„ë£Œ, íŒŒì‹± ì‹œì‘...');
                        const csvContent = e.target.result;
                        console.log('íŒŒì¼ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°:', csvContent.substring(0, 500));
                        
                        // ì—¬ëŸ¬ ì¸ì½”ë”©ê³¼ êµ¬ë¶„ì ì‹œë„
                        const parseOptions = [
                            { header: true, skipEmptyLines: true, delimiter: ',', dynamicTyping: false },
                            { header: true, skipEmptyLines: true, delimiter: ';', dynamicTyping: false },
                            { header: true, skipEmptyLines: true, delimiter: '\t', dynamicTyping: false }
                        ];
                setParts(sampleData);
            }, []);

            // ê²€ìƒ‰ í•„í„°ë§
            const filteredParts = useMemo(() => {
                if (!searchTerm || !parts.length) return parts;
                
                const term = searchTerm.toLowerCase().trim();
                console.log('ê²€ìƒ‰ì–´:', term, 'ë°ì´í„° ê°œìˆ˜:', parts.length);
                
                const results = parts.filter(part => {
                    const matches = 
                        (part['P/N'] && part['P/N'].toLowerCase().includes(term)) ||
                        (part['DESCRIPTION'] && part['DESCRIPTION'].toLowerCase().includes(term)) ||
                        (part['MFG'] && part['MFG'].toLowerCase().includes(term)) ||
                        (part['MFG P/N'] && part['MFG P/N'].toLowerCase().includes(term)) ||
                        (part['Vender'] && part['Vender'].toLowerCase().includes(term)) ||
                        (part['Classification'] && part['Classification'].toLowerCase().includes(term)) ||
                        (part['Location'] && part['Location'].toLowerCase().includes(term)) ||
                        (part['Note'] && part['Note'].toLowerCase().includes(term));
                    
                    return matches;
                });
                
                console.log('ê²€ìƒ‰ ê²°ê³¼:', results.length, 'ê°œ');
                return results;
            }, [parts, searchTerm]);

            const handleGoogleSearch = (query = searchTerm) => {
                if (query) {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                }
            };

            const handleImageSearch = (query = searchTerm) => {
                if (query) {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}&tbm=isch`, '_blank');
                }
            };

            const handlePartSearch = (part) => {
                const searchQuery = `${part['MFG']} ${part['MFG P/N'] || part['DESCRIPTION']}`;
                return searchQuery.trim();
            };

            if (loading) {
                return (
                    <div className="container">
                        <div className="loading">
                            <div className="spinner"></div>
                            <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
                            <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <div className="header">
                        <div className="github-badge">GitHub Pages</div>
                        <h1 className="title">AXCELIS íŒŒíŠ¸ê²€ìƒ‰</h1>
                        <p className="subtitle">ì™„ì „ ë…ë¦½í˜• ë¶€í’ˆ ê²€ìƒ‰ ì‹œìŠ¤í…œ</p>
                        
                        {/* íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ */}
                        <div className="upload-section">
                            <label className="upload-btn" style={{cursor: 'pointer', display: 'inline-block'}}>
                                ğŸ“ CSV íŒŒì¼ ì—…ë¡œë“œ
                                <input 
                                    type="file" 
                                    accept=".csv" 
                                    onChange={handleFileUpload}
                                    style={{display: 'none'}}
                                />
                            </label>
                            
                            <div className={`status-info ${
                                dataSource === 'sample' ? 'status-sample' : 
                                dataSource === 'uploaded' ? 'status-uploaded' : 'status-restored'
                            }`}>
                                {dataSource === 'sample' && `ğŸ“‹ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš© ì¤‘ (${parts.length}ê°œ) - "510002038" ê²€ìƒ‰í•´ë³´ì„¸ìš”`}
                                {dataSource === 'uploaded' && `âœ… ì—…ë¡œë“œëœ CSV íŒŒì¼ ì‚¬ìš© ì¤‘ (${parts.length}ê°œ ë¶€í’ˆ)`}
                                {dataSource === 'restored' && `ğŸ”„ ì €ì¥ëœ ë°ì´í„° ë³µì›ë¨ (${parts.length}ê°œ ë¶€í’ˆ)`}
                            </div>
                        </div>
                        
                        <div className="search-box">
                            <input
                                type="text"
                                className="search-input"
                                placeholder="P/N, DESCRIPTION, MFG, Classification, Location ë“±ìœ¼ë¡œ ê²€ìƒ‰..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        
                        <div className="search-buttons">
                            <button 
                                className="btn btn-google"
                                onClick={() => handleGoogleSearch()}
                                disabled={!searchTerm}
                            >
                                ğŸ” êµ¬ê¸€ê²€ìƒ‰
                            </button>
                            <button 
                                className="btn btn-image"
                                onClick={() => handleImageSearch()}
                                disabled={!searchTerm}
                            >
                                ğŸ“· ì´ë¯¸ì§€ê²€ìƒ‰
                            </button>
                        </div>
                    </div>

                    <div className="stats">
                        ğŸ“Š ì´ {parts.length}ê°œ ì¤‘ {filteredParts.length}ê°œ ê²€ìƒ‰ë¨
                    </div>

                    <div className="results">
                        {filteredParts.length === 0 ? (
                            <div className="no-results">
                                <h3>ğŸ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì‹œê±°ë‚˜ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</p>
                                {searchTerm && (
                                    <button 
                                        className="btn btn-google" 
                                        onClick={() => handleGoogleSearch()}
                                    >
                                        êµ¬ê¸€ì—ì„œ "{searchTerm}" ê²€ìƒ‰í•˜ê¸°
                                    </button>
                                )}
                            </div>
                        ) : (
                            filteredParts.map((part, index) => (
                                <div key={index} className="part-item">
                                    <div className="part-number">ğŸ“¦ {part['P/N']}</div>
                                    <div className="part-name">{part['DESCRIPTION']}</div>
                                    
                                    <div className="part-details">
                                        {part['MFG'] && (
                                            <div className="detail-item">
                                                <div className="detail-label">MFG</div>
                                                <div className="detail-value">{part['MFG']}</div>
                                            </div>
                                        )}
                                        {part['MFG P/N'] && (
                                            <div className="detail-item">
                                                <div className="detail-label">MFG P/N</div>
                                                <div className="detail-value">{part['MFG P/N']}</div>
                                            </div>
                                        )}
                                        {part['REV'] && (
                                            <div className="detail-item">
                                                <div className="detail-label">REV</div>
                                                <div className="detail-value">ğŸ”„ {part['REV']}</div>
                                            </div>
                                        )}
                                        {part['Vender'] && (
                                            <div className="detail-item">
                                                <div className="detail-label">Vender</div>
                                                <div className="detail-value">{part['Vender']}</div>
                                            </div>
                                        )}
                                        {part['Classification'] && (
                                            <div className="detail-item detail-category">
                                                <div className="detail-label">Classification</div>
                                                <div className="detail-value">ğŸ·ï¸ {part['Classification']}</div>
                                            </div>
                                        )}
                                        {part['Location'] && (
                                            <div className="detail-item detail-location">
                                                <div className="detail-label">Location</div>
                                                <div className="detail-value">ğŸ“ {part['Location']}</div>
                                            </div>
                                        )}
                                        {part['24 Price'] && (
                                            <div className="detail-item detail-price">
                                                <div className="detail-label">24 Price</div>
                                                <div className="detail-value">ğŸ’° â‚©{part['24 Price']}</div>
                                            </div>
                                        )}
                                        {part['25 Price'] && (
                                            <div className="detail-item detail-price">
                                                <div className="detail-label">25 Price</div>
                                                <div className="detail-value">ğŸ’° â‚©{part['25 Price']}</div>
                                            </div>
                                        )}
                                        {part['Note'] && (
                                            <div className="detail-item">
                                                <div className="detail-label">Note</div>
                                                <div className="detail-value">ğŸ“ {part['Note']}</div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="part-actions">
                                        <button
                                            className="btn btn-google btn-small"
                                            onClick={() => handleGoogleSearch(handlePartSearch(part))}
                                        >
                                            ğŸ” êµ¬ê¸€ê²€ìƒ‰
                                        </button>
                                        <button
                                            className="btn btn-image btn-small"
                                            onClick={() => handleImageSearch(handlePartSearch(part))}
                                        >
                                            ğŸ“· ì´ë¯¸ì§€ê²€ìƒ‰
                                        </button>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    
                    {/* PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ */}
                    {showInstallPrompt && (
                        <div className="install-prompt" onClick={handleInstallClick}>
                            ğŸ“± í™ˆí™”ë©´ì— ì¶”ê°€í•˜ê¸°
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<PartSearchApp />, document.getElementById('root'));
    </script>

    <!-- PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                .then((registration) => {
                    console.log('SW registered: ', registration);
                })
                .catch((registrationError) => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }
    </script>
</body>
</html>
                        
                        let parsedData = null;
                        let usedDelimiter = '';
                        
                        for (let options of parseOptions) {
                            try {
                                const testParse = Papa.parse(csvContent, options);
                                if (testParse.data.length > 0 && testParse.meta.fields.length > 5) {
                                    parsedData = testParse;
                                    usedDelimiter = options.delimiter;
                                    break;
                                }
                            } catch (e) {
                                console.log('íŒŒì‹± ì‹œë„ ì‹¤íŒ¨:', options.delimiter);
                            }
                        }
                        
                        if (!parsedData) {
                            throw new Error('ì ì ˆí•œ êµ¬ë¶„ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        
                        console.log('íŒŒì‹± ì™„ë£Œ! êµ¬ë¶„ì:', usedDelimiter, 'ë°ì´í„° ê°œìˆ˜:', parsedData.data.length);
                        console.log('ì»¬ëŸ¼ëª…:', parsedData.meta.fields);
                        
                        // ì»¬ëŸ¼ëª… ë§¤í•‘ (ìˆ˜ì •ëœ ì˜ë¬¸ í—¤ë” ê¸°ì¤€)
                        const getFieldValue = (row, ...fieldNames) => {
                            for (let fieldName of fieldNames) {
                                if (row[fieldName] !== undefined && row[fieldName] !== null && row[fieldName] !== '') {
                                    // ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  ì•ë’¤ ê³µë°± ì œê±°
                                    const value = String(row[fieldName]).trim();
                                    if (value !== 'null' && value !== 'undefined' && value !== '') {
                                        return value;
                                    }
                                }
                            }
                            return '';
                        };
                        
                        // ì‹¤ì œ ì»¬ëŸ¼ëª… í™•ì¸ ë° ë§¤í•‘
                        const fields = parsedData.meta.fields;
                        console.log('ì‹¤ì œ ì»¬ëŸ¼ëª…ë“¤:', fields);
                        
                        // ìˆ˜ì •ëœ ì˜ë¬¸ í—¤ë”ì— ë§ì¶˜ ì»¬ëŸ¼ ë§¤í•‘
                        const findColumn = (searchTerms) => {
                            return fields.find(field => 
                                searchTerms.some(term => 
                                    field.toLowerCase().includes(term.toLowerCase()) ||
                                    field.includes(term) ||
                                    field.trim() === term
                                )
                            );
                        };
                        
                        const partNumberCol = findColumn(['P/N', 'PN', 'Part Number', 'PartNumber']);
                        const partNameCol = findColumn(['DESCRIPTION', 'Description', 'Part Name', 'Name']);
                        const revCol = findColumn(['REV', 'Rev', 'Revision']);
                        const manufacturerCol = findColumn(['MFG', 'Manufacturer', 'Mfg']);
                        const mfgPartCol = findColumn(['MFG P/N', 'MFG_P/N', 'MfgPN', 'Manufacturer Part']);
                        const supplierCol = findColumn(['Vender', 'Vendor', 'Supplier']);
                        const noteCol = findColumn(['Note', 'note', 'Notes', 'Comment', 'Remarks']);
                        const categoryCol = findColumn(['Classification', 'Category', 'Type', 'Class']);
                        const locationCol = findColumn(['Location', 'Storage', 'Warehouse']);
                        const price24Col = findColumn(['24 Price', '24Price', '2024 Price', 'Price 24']);
                        const price25Col = findColumn(['25 Price', '25Price', '2025 Price', 'Price 25']);
                        
                        console.log('ì»¬ëŸ¼ ë§¤í•‘ ê²°ê³¼:');
                        console.log('P/N:', partNumberCol);
                        console.log('DESCRIPTION:', partNameCol);
                        console.log('REV:', revCol);
                        console.log('MFG:', manufacturerCol);
                        console.log('MFG P/N:', mfgPartCol);
                        console.log('Vender:', supplierCol);
                        console.log('Note:', noteCol);
                        console.log('Classification:', categoryCol);
                        console.log('Location:', locationCol);
                        console.log('24 Price:', price24Col);
                        console.log('25 Price:', price25Col);
                        
                        // ì²« ë²ˆì§¸ í–‰ì˜ Location ê°’ í™•ì¸
                        if (parsedData.data.length > 0) {
                            const firstRow = parsedData.data[0];
                            console.log('ì²« ë²ˆì§¸ í–‰ ì „ì²´:', firstRow);
                            if (locationCol) {
                                console.log(`Location ì»¬ëŸ¼ (${locationCol}) ê°’:`, firstRow[locationCol]);
                                console.log('Location ê°’ íƒ€ì…:', typeof firstRow[locationCol]);
                            }
                        }
                        
                        // ëª¨ë°”ì¼ ìµœì í™”: ë°°ì¹˜ ì²˜ë¦¬
                        const batchSize = 100;
                        const totalRows = parsedData.data.length;
                        console.log(`ì´ ${totalRows}ê°œ ë°ì´í„°ë¥¼ ${batchSize}ê°œì”© ë°°ì¹˜ ì²˜ë¦¬í•©ë‹ˆë‹¤...`);
                        
                        let cleanedData = [];
                        
                        for (let i = 0; i < totalRows; i += batchSize) {
                            const batch = parsedData.data.slice(i, i + batchSize);
                            const processedBatch = batch
                                .filter(row => {
                                    const partNumber = partNumberCol ? getFieldValue(row, partNumberCol) : '';
                                    return partNumber && partNumber.length > 0;
                                })
                                .map(row => ({
                                    'P/N': partNumberCol ? getFieldValue(row, partNumberCol) : '',
                                    'DESCRIPTION': partNameCol ? getFieldValue(row, partNameCol) : '',
                                    'REV': revCol ? getFieldValue(row, revCol) : '',
                                    'MFG': manufacturerCol ? getFieldValue(row, manufacturerCol) : '',
                                    'MFG P/N': mfgPartCol ? getFieldValue(row, mfgPartCol) : '',
                                    'Vender': supplierCol ? getFieldValue(row, supplierCol) : '',
                                    'Note': noteCol ? getFieldValue(row, noteCol) : '',
                                    'Classification': categoryCol ? getFieldValue(row, categoryCol) : '',
                                    'Location': locationCol ? getFieldValue(row, locationCol) : '',
                                    '24 Price': price24Col ? getFieldValue(row, price24Col) : '',
                                    '25 Price': price25Col ? getFieldValue(row, price25Col) : '',
                                    // ì¶”ê°€ ë°ì´í„° (ê²€ìƒ‰ìš©, í‘œì‹œ ì•ˆí•¨)
                                    'ëŒ€ì²´í’ˆì—¬ë¶€': getFieldValue(row, 'ëŒ€ì²´í’ˆì—¬ë¶€', 'Alternative'),
                                    'ê¸°ì¡´í’ˆì œì¡°ì‚¬': getFieldValue(row, 'ê¸°ì¡´í’ˆì œì¡°ì‚¬', 'Original Mfg'),
                                    'ê¸°ì¡´í’ˆí’ˆë²ˆ': getFieldValue(row, 'ê¸°ì¡´í’ˆí’ˆë²ˆ', 'Original P/N')
                                }));
                            
                            cleanedData = cleanedData.concat(processedBatch);
                            
                            // ì§„í–‰ë¥  í‘œì‹œ
                            const progress = Math.min(100, Math.round(((i + batchSize) / totalRows) * 100));
                            console.log(`ì²˜ë¦¬ ì§„í–‰ë¥ : ${progress}% (${cleanedData.length}ê°œ ì™„ë£Œ)`);
                            
                            // ëª¨ë°”ì¼ì—ì„œ UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•œ ì§§ì€ ëŒ€ê¸°
                            if (i % (batchSize * 5) === 0) {
                                await new Promise(resolve => setTimeout(resolve, 10));
                            }
                        }
                        
                        console.log('ë°ì´í„° ì •ë¦¬ ì™„ë£Œ:', cleanedData.length, 'ê°œ');
                        console.log('ì²« ë²ˆì§¸ ë°ì´í„° ìƒ˜í”Œ:', cleanedData[0]);
                        
                        if (cleanedData.length === 0) {
                            throw new Error('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í’ˆë²ˆ ì»¬ëŸ¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        }
                        
                        setParts(cleanedData);
                        setDataSource('uploaded');
                        
                        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                        try {
                            localStorage.setItem('axcelis-parts-data', JSON.stringify(cleanedData));
                            localStorage.setItem('axcelis-data-timestamp', Date.now().toString());
                        } catch (e) {
                            console.log('ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨:', e);
                        }
                        
                        alert(`âœ… ${cleanedData.length}ê°œì˜ ë¶€í’ˆ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤!\n\nì»¬ëŸ¼: ${parsedData.meta.fields.join(', ')}`);
                        
                    } catch (error) {
                        console.error('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜:', error);
                        alert(`âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ${error.message}\n\níŒŒì¼ì´ ì˜¬ë°”ë¥¸ CSV í˜•ì‹ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`);
                    }
                    setLoading(false);
                };
                
                reader.onerror = (error) => {
                    console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                    alert('âŒ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    setLoading(false);
                };
                
                // UTF-8, EUC-KR ë“± ë‹¤ì–‘í•œ ì¸ì½”ë”© ì‹œë„
                try {
                    reader.readAsText(file, 'utf-8');
                } catch (e) {
                    try {
                        reader.readAsText(file, 'euc-kr');
                    } catch (e2) {
                        reader.readAsText(file);
                    }
                }
            };
            
            // ì´ˆê¸°í™” (ìƒ˜í”Œ ë°ì´í„° + ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë³µì›)
            useEffect(() => {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë³µì› ì‹œë„
                try {
                    const savedData = localStorage.getItem('axcelis-parts-data');
                    const savedTimestamp = localStorage.getItem('axcelis-data-timestamp');
                    
                    if (savedData && savedTimestamp) {
                        const data = JSON.parse(savedData);
                        const timestamp = parseInt(savedTimestamp);
                        const hoursSinceUpload = (Date.now() - timestamp) / (1000 * 60 * 60);
                        
                        if (data.length > 0 && hoursSinceUpload < 24) { // 24ì‹œê°„ ì´ë‚´
                            setParts(data);
                            setDataSource('restored');
                            console.log('ë¡œì»¬ ë°ì´í„° ë³µì› ì™„ë£Œ:', data.length, 'ê°œ');
                            return;
                        }
                    }
                } catch (e) {
                    console.log('ë¡œì»¬ ë°ì´í„° ë³µì› ì‹¤íŒ¨:', e);
                }
                
                // ìƒ˜í”Œ ë°ì´í„°ë¡œ ì‹œì‘
                const sampleData = [
                    {
                        'P/N': '100841',
                        'DESCRIPTION': 'WIRE-HOOKUP, 16GA, VINYL, BLK',
                        'MFG': 'ALPHAWIRE',
                        'MFG P/N': '3077',
                        'Vender': 'Mouser',
                        'Classification': 'General Parts',
                        'Location': 'Warehouse-A1',
                        '24 Price': '3333',
                        '25 Price': '3333',
                        'REV': '',
                        'Note': ''
                    },
                    {
                        'P/N': '510002038',
                        'DESCRIPTION': 'Test Component - Sample Data',
                        'MFG': 'Test Manufacturer',
                        'MFG P/N': 'TEST-001',
                        'Vender': 'Test Supplier',
                        'Classification': 'Special Parts',
                        'Location': 'Warehouse-B2',
                        '24 Price': '10000',
                        '25 Price': '12000',
                        'REV': 'A',
                        'Note': 'Sample data for testing'
                    }
